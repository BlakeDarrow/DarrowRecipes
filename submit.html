<!DOCTYPE html>
<html class="writer-html5" lang="en">

<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Recipe Submission</title>
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/css/custom.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/general.css" type="text/css" />
  <link rel="stylesheet" href="_static/dark_mode_css/dark.css" type="text/css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
  <script src="_static/jquery.js"></script>
  <script src="_static/underscore.js"></script>
  <script src="_static/doctools.js"></script>
  <script src="_static/logo_link.js"></script>
  <script src="_static/dark_mode_js/default_light.js"></script>
  <script src="_static/sphinx_highlight.js"></script>
  <script src="_static/dark_mode_js/default_dark.js"></script>
  <script src="_static/dark_mode_js/theme_switcher.js"></script>
  <script src="_static/js/theme.js"></script>
  <link rel="index" title="Index" href="genindex" />
  <link rel="search" title="Search" href="search" />
  <script type="module">
    import { authenticateUser } from './_static/js/main.js';
    import { commitFile } from './_static/js/main.js';
    import { triggerDeleteWorkflowRuns } from './_static/js/main.js';
    import { checkCookie } from './_static/js/main.js';
    import { getCookie } from './_static/js/main.js';
    import { setCookie } from './_static/js/main.js';
    import { monitorWorkflowStatus } from './_static/js/main.js';
    import { Octokit } from "https://cdn.skypack.dev/@octokit/rest";

    checkCookie("password");

    var testMode = false; // Don't commit to GitHub
    var deleteWorkflowRuns = false;

    if (testMode) {
      console.log("Using debug mode. Commits will NOT be pushed to GitHub!")

      var status = document.getElementById("status");
      status.style.display = "block";
      status.innerHTML = "Debug mode...";

      var progress = document.getElementById("progress");
      var progressBar = document.getElementById("progress-fill");

      var debugMenu = document.getElementById("hiddenDebug");

      progressBar.style.width = "50%";
      progressBar.style.display = "block";
      progress.style.display = "block";
      debugMenu.style.display = "block";
    }

    let autoLogin = getCookie("remember-me");

    if (autoLogin) {
      let passwordCookie = getCookie("password");

      if (passwordCookie !== "") {
        var passwordId = document.getElementById("password");
        var password = passwordId.value;
        if (password === "") {
          password.value = "None"
        }

        passwordId.addEventListener("input", function () {
          password = password.value;
        });

        console.log("Attempting to authenticate with token...")
        authenticateUser(password);
      }
    }

    document.getElementById("logout").addEventListener("click", async () => {
      setCookie("password", "", 365);
      setCookie("remember-me", "False", 365);
      setCookie("username", "", 365);
      document.getElementById("password").value = "";
      document.getElementById("file-name").value = "";
      document.getElementById("Ingredients").value = "";
      document.getElementById("Prep").value = "";
      document.getElementById("Directions").value = "";
      document.getElementById("Category").value = "";
      document.getElementById("editedByValue").value = "";
      document.getElementById("submittedByValue").value = "";
      document.getElementById("authentication-form").style.display = "block";
      document.getElementById("submit-form").style.display = "none";
      console.log("Attempting to logout user...")

    });

    if (testMode) {
      document.getElementById("monitor-workflow").addEventListener("click", async () => {
        console.log("Attempting to monitor workflow runs..");
        var passwordId = document.getElementById("password");
        var password = passwordId.value;
        passwordId.addEventListener("input", function () {
          password = password.value;
        });
        const octokit = new Octokit({ auth: password });
        monitorWorkflowStatus(octokit,"BlakeDarrow","DarrowRecipes");
      });
    }

    document.getElementById("clear-file").addEventListener("click", async () => {
      document.getElementById("file-name").value = "";
      document.getElementById("Ingredients").value = "";
      document.getElementById("Prep").value = "";
      document.getElementById("Directions").value = "";
      document.getElementById("Category").value = "";
      document.getElementById("editedByValue").value = "";
      document.getElementById("submittedByValue").value = "";
      autosize('Ingredients');
      autosize('Prep');
      autosize('Directions');
      console.log("Form reset.")
    });

    document.getElementById("login").addEventListener("click", async () => {
      var passwordId = document.getElementById("password");
      var password = passwordId.value;
      passwordId.addEventListener("input", function () {
        password = passwordId.value;
      });
      authenticateUser(password)
    });

    document.getElementById("commit-file").addEventListener("click", async () => {
      var passwordId = document.getElementById("password");
      var password = passwordId.value;
      passwordId.addEventListener("input", function () {
        password = password.value;
      });

      var CategoryInput = document.getElementById("Category");
      var Category = CategoryInput.value;
      CategoryInput.addEventListener("input", function () {
        Category = contentInput.value;
      });

      var formattedCategory = Category.replaceAll(/\s/g, '').split(',').map(i => '#' + i).join(', ');

      var nameInput = document.getElementById("file-name");
      var name = nameInput.value;
      nameInput.addEventListener("input", function () {
        name = nameInput.value;
      });

      var extension = ".rst"

      var sourceFolder = "source/sphinx/recipes/"

      var filepath = sourceFolder + name + extension;

      var DirectionsInput = document.getElementById("Directions");
      var Directions = DirectionsInput.value;
      DirectionsInput.addEventListener("input", function () {
        Directions = DirectionsInput.value.replaceAll(/\r/g, "");
      });

      var PrepInput = document.getElementById("Prep");
      var Prep = PrepInput.value;
      PrepInput.addEventListener("input", function () {
        Prep = PrepInput.value.replaceAll(/\r/g, "");
      });

      var IngredientsInput = document.getElementById("Ingredients");
      var Ingredients = IngredientsInput.value;
      IngredientsInput.addEventListener("input", function () {
        Ingredients = IngredientsInput.value.replaceAll(/\r/g, "");
      });

      var nameFormat = "###########################################################"
      var categoryFormat = "========================================================="
      var spacerFormat = " "
      var tagSpacer = "------"
      var allowCommit = true
      var errorMessage = "error"
      var now = new Date();
      var options = { timeZone: "America/Chicago" };
      var cstDate = now.toLocaleString("en-US", options);
      var time = `${cstDate.split(',')[1].trim()} on ${cstDate.split(',')[0].replace(/\//g, '-')}`;
      var username = getCookie("username");
      var newRecipe = false;
      var commitMessage = "Empty";

      var submittedByValue = document.getElementById("submittedByValue");
      if (submittedByValue.value === "") {
        if (!checkIfTextIsInClass(name)) {
          console.log("New recipe being submitted!")
          console.log("----------")
          newRecipe = true;
        }
      }
      var editedByValue = document.getElementById("editedByValue");
      var editedBy = `Empty`;
      var submittedBy = "";
      if (newRecipe) {
        submittedBy = `${username} created '${name}' at ${time}.`;
        editedBy = "This recipe has not been edited."
        submittedByValue.value = submittedBy;
        editedByValue.value = "This recipe has not been edited."
        commitMessage = submittedBy;
      } else {
        editedBy = `${username} edited '${name}' at ${time}.`;
        editedByValue.value = editedBy;
        submittedBy = submittedByValue.value;
        commitMessage = editedBy;
      }

      var content = name + '\n'
        + nameFormat + '\n'
        + spacerFormat + '\n'
        + 'Ingredients\n'
        + categoryFormat + '\n'
        + spacerFormat + '\n'
        + Ingredients + '\n'
        + spacerFormat + '\n'
        + 'Prep\n'
        + categoryFormat + '\n'
        + spacerFormat + '\n'
        + Prep + '\n'
        + spacerFormat + '\n'
        + 'Directions\n'
        + categoryFormat + '\n'
        + spacerFormat + '\n'
        + Directions + '\n'
        + spacerFormat + '\n'
        + tagSpacer + '\n'
        + spacerFormat + '\n'
        + formattedCategory + '\n'
        + spacerFormat + '\n'
        + "| " + editedBy + '\n'
        + "| " + submittedBy;

      if (name === "") {
        allowCommit = false;
        errorMessage = "No recipe name provided.";
      }

      if (Ingredients === "" && Prep === "" && Directions === "") {
        allowCommit = false;
        errorMessage = "The recipe is blank.";
      }

      function isValidString(str) {
        var validChars = /^[\s\S]*$/;
        return validChars.test(str);
      }

      if (!isValidString(content)) {
        allowCommit = false;
        errorMessage = "The recipe contains invalid characters.";
      }

      var commitBody = "Automated recipe build";

      var destinationName = "BlakeDarrow/DarrowRecipes";

      let workflowID = 44429210;

      var filepath = filepath.replaceAll(/\s/g, "");

      if (allowCommit) {
        if (testMode) {
          console.log("User would send:")
          console.log([content]);

          if (deleteWorkflowRuns) {

            triggerDeleteWorkflowRuns(destinationName, password, workflowID);

          }

        } else {

          console.log("User wants to send:")
          console.log([content]);
          commitFile(filepath, content, commitMessage, destinationName, password, workflowID, commitBody);

        }

      } else {
        alert(`Error: ${errorMessage}`);
      }

    });

  </script>
  <script>
    function checkIfTextIsInClass(inputText) {
      const elementsWithClass = document.querySelectorAll(".toctree-l1");
      const recipeExistsMsg = document.getElementById("tooltiptext");
      var inputTextNoWhitespace = inputText.replace(/\s/g, '').toLowerCase();;
      for (let i = 0; i < elementsWithClass.length; i++) {
        var textContentNoWhitespace = elementsWithClass[i].textContent.replace(/\s/g, '').toLowerCase();;
        if (textContentNoWhitespace === inputTextNoWhitespace) {
          console.log("Recipe exists!");
          recipeExistsMsg.style.display = "inline-block";
          return true;
        }
      }
      recipeExistsMsg.style.display = "none";
      return false;
    }

    // https://stackoverflow.com/questions/7745741/auto-expanding-textarea/24824750#24824750
    function autosize(textarea_id, row_limit) {
      // Set default for row_limit parameter
      row_limit = parseInt(row_limit ?? '25');
      if (!row_limit) {
        row_limit = 25;
      }
      // Get the element
      const textarea = document.getElementById(textarea_id);

      // Set required styles for this to function properly.
      textarea.style.setProperty('resize', 'none');
      textarea.style.setProperty('min-height', '0');
      textarea.style.setProperty('max-height', 'none');
      textarea.style.setProperty('height', 'auto');

      var setRows = function () {
        // Reset rows attribute to get accurate scrollHeight
        textarea.setAttribute('rows', '1');

        // Get the computed values object reference
        const cs = getComputedStyle(textarea);

        // Force content-box for size accurate line-height calculation
        // Remove scrollbars, lock width (subtract inline padding and inline border widths)
        // and remove inline padding and borders to keep width consistent (for text wrapping accuracy)
        const inline_padding = parseFloat(cs['padding-left']) + parseFloat(cs['padding-right']);
        const inline_border_width = parseFloat(cs['border-left-width']) + parseFloat(cs['border-right-width']);
        textarea.style.setProperty('overflow', 'hidden', 'important');
        textarea.style.setProperty('width', (parseFloat(cs['width']) - inline_padding - inline_border_width) + 'px');
        textarea.style.setProperty('box-sizing', 'content-box');
        textarea.style.setProperty('padding-inline', '0');
        textarea.style.setProperty('border-width', '0');

        // Get the base line height, and top / bottom padding.
        const block_padding = parseFloat(cs['padding-top']) + parseFloat(cs['padding-bottom']);
        const line_height =
          // If line-height is not explicitly set, use the computed height value (ignore padding due to content-box)
          cs['line-height'] === 'normal' ? parseFloat(cs['height'])
            // Otherwise (line-height is explicitly set), use the computed line-height value.
            : parseFloat(cs['line-height']);

        // Get the scroll height (rounding to be safe to ensure cross browser consistency)
        const scroll_height = Math.round(textarea.scrollHeight);

        // Undo overflow, width, border-width, box-sizing & inline padding overrides
        textarea.style.removeProperty('width');
        textarea.style.removeProperty('box-sizing');
        textarea.style.removeProperty('padding-inline');
        textarea.style.removeProperty('border-width');
        textarea.style.removeProperty('overflow');

        // Subtract block_padding from scroll_height and divide that by our line_height to get the row count.
        // Round to nearest integer as it will always be within ~.1 of the correct whole number.
        const rows = Math.round((scroll_height - block_padding) / line_height);

        // Set the calculated rows attribute (limited by row_limit)
        textarea.setAttribute("rows", "" + Math.min(rows, row_limit));
      };
      setRows(); // trigger once to ensure updates
      textarea.oninput = setRows;
      // Trigger the event to set the initial rows value
      textarea.dispatchEvent(new Event('value', {
        bubbles: true
      }));
    }

    function loadRecipe(Name, Ingredients, Prep, Directions, Category, submittedBy) {
      if (getComputedStyle(document.getElementById("authentication-form")).display === "block") {
        alert("Login to edit this recipe.");
      } else {
        document.getElementById("editedByValue").value = "";
        document.getElementById("submittedByValue").value = "";
        document.getElementById("file-name").value = Name;
        document.getElementById("Ingredients").value = Ingredients.split("&bladar&").join("\n").replaceAll(/ +(?= )/g, '').replaceAll("$apo$", "'").replaceAll("^col^", ";").replaceAll('@inch@', '"');
        document.getElementById("Prep").value = Prep.split("&bladar&").join("\n").replaceAll(/ +(?= )/g, '').replaceAll("$apo$", "'").replaceAll("^col^", ";").replaceAll('@inch@', '"');
        document.getElementById("Directions").value = Directions.split("&bladar&").join("\n").replaceAll(/ +(?= )/g, '').replaceAll("$apo$", "'").replaceAll("^col^", ";").replaceAll('@inch@', '"');
        document.getElementById("Category").value = Category;
        var author = submittedBy.split(",")
        author = author.filter(function (element) { return element !== ""; });
        console.log(`User selected '${Name}'.`);

        var submittedByValue = document.getElementById("submittedByValue");
        if (author.length > 0) {
          submittedByValue.value = author[1].replaceAll("^quote^", "'");
        }

        // Set all the textarea to be auto expanding.
        autosize('Ingredients');
        autosize('Prep');
        autosize('Directions');
      }
    }
  </script>
</head>

<body class="wy-body-for-nav">
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          <a href="https://blakedarrow.github.io/DarrowRecipes/" class="icon icon-home"> DarrowRecipes
          </a>
          <div role="search">
            <form id="rtd-search-form" class="wy-form" action="search" method="get">
              <input type="text" name="q" placeholder="Search docs" />
              <input type="hidden" name="check_keywords" value="yes" />
              <input type="hidden" name="area" value="default" />
            </form>
          </div>
        </div>
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
          <ul class="current" id="file-list-container">
            <p class="caption" role="heading"><span class="caption-text">All Recipes</span></p>
            <li class="toctree-l1"><a class="reference internal">User not logged in</a></li>
          </ul>
        </div>
      </div>
    </nav>
    </nav>
    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" aria-label="Mobile navigation menu">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="https://blakedarrow.github.io/DarrowRecipes/">DarrowRecipes</a>
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
            <ul class="wy-breadcrumbs">
              <li><a href="https://blakedarrow.github.io/DarrowRecipes/" class="icon icon-home"></a> &raquo;</li>
              <li>Recipe Submission</li>
              <li class="wy-breadcrumbs-aside">
              </li>
            </ul>
            <hr />
          </div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div itemprop="articleBody">
              <section id="publish">
                <h1>Recipe Submission</h1>
                <div class="darrow" id="form-group" style="display:block">
                  <div id="authentication-form" style="display:block">
                    <form action="#">
                      <label for="password">Password:</label>
                      <input type="password" id="password" name="password" autocomplete="on" value="">
                      <button type="button" id="login">Login</button>
                    </form>
                    <br>
                    <input type="checkbox" id="remember-me" checked> Remember Me
                    <br>
                    <center>
                      <p id="error-message" style="display:none"></p>
                    </center>
                  </div>
                </div>
                <div class="hiddenDebug" id="hiddenDebug" style="display: none;">
                  <hr>
                  <label for="editedByValue">Edited by:</label>
                  <input type="text" id="editedByValue" name="editedByValue" value=""><br><br>
                  <label for="submittedByValue">Submitted by:</label>
                  <input type="text" id="submittedByValue" name="submittedByValue" value=""><br><br>
                  <button type="button" id="monitor-workflow">Monitor Workflow</button>
                  <hr>
                </div>
                <div class="darrow" id="submit-form" style="display:none">
                  <form action="#">
                    <label for="file-name">Recipe Name:</label>
                    <span id="recipe-exists-msg" class="tooltip" style="display: block">
                      <span class="tooltiptext" id="tooltiptext" style="display: none">This recipe name exists. Are you
                        editing an existing Recipe?</span>
                      <input type="text" id="file-name" name="file-name" value="" maxlength="58"
                        oninput="this.value = this.value.replace(/[^A-Za-z- 0-9]/g, ''); checkIfTextIsInClass(this.value)"
                        placeholder=""><br><br>
                    </span>
                    <label for=" Ingredients">Ingredients:</label>
                    <textarea id="Ingredients" name="Ingredients" value="" placeholder=""
                      oninput="this.value = this.value.replace(/’/g, '\'')"></textarea><br><br>
                    <label for="Prep">Prep:</label>
                    <textarea id="Prep" name="Prep" value="" placeholder=""
                      oninput="this.value = this.value.replace(/’/g, '\'')"></textarea><br><br>
                    <label for="Directions">Directions:</label>
                    <textarea id="Directions" name="Directions" value="" placeholder=""
                      oninput="this.value = this.value.replace(/’/g, '\'')"></textarea><br><br>
                    <label for="Category">Tags:</label>
                    <input type="text" id="Category" name="Category" value="" placeholder=""
                      oninput="this.value = this.value.replace(/[^A-Za-z,-/ 0-9]/g, '')">
                    <hr>
                    <div class="button_group">
                      <button type="button" id="commit-file">Publish Recipe</button>
                      <button type="button" id="clear-file">Reset</button>
                      <button type="button" id="cancel-button" style="display: none;">Cancel</button>
                    </div>
                    <span>
                      <div class="status" id="status" style="display: none;"></div>
                    </span>
                    <div class="progress-bar" style="display: none;" id="progress">
                      <div class="progress" style="width: 5%; display: block;" id="progress-fill"></div>
                  </form>
                  <script>
                  </script>
                </div>
                <br><br>
                <hr>
                <h1>Help</h1>
                <ol>
                  <!-- <li>For the best recipe format please use bullet points for the Ingredients, and a numbered list for the Prep and Directions.</li>  -->
                  <li>If you're making a multi-line list, remember to use bullet points or ordered lists.</li>
                  <li>Ensure each element in a list contains a space after the identifier. For example "1. Preheat oven" or "- Preheat oven".</li>
                  <li>Line breaks between elements are not retained when loading an existing recipe to edit. Please add them back.</li>
                  <li>Remember to separate tags with commas and a space, and '#' will be automatically added. Feel free
                    to use your name as a tag!</li>
                  <li>To edit an existing recipe, simply go to the 'All Recipes' panel on the left-hand side of the
                    screen, select the desired recipe, and the editing form will automatically display the recipe
                    content.</li>
                  <li>Only certain characters are allowed in the recipe name. This includes letters, numbers, and
                    dashes.</li>
                  <li>Editing an existing recipe name will create a new recipe, not change the name!</li>
                  <li>For any questions please reach out to Blake!</li>
                  <li>For any problems check the <a href="" onclick="toggleDivVisibility(); event.preventDefault();">log</a>.</li>
                  <li>Logout <a href="" id="logout">here.</a></li>
                </ol>
                <script>
                  function toggleDivVisibility() {
                    const myDiv = document.getElementById('log');
                    myDiv.style.display = myDiv.style.display === 'none' ? 'block' : 'none';
                  }
                </script>
                <div id="log" style="display:none">
                  <hr>
                  <h1>Log</h1>
                  <div class="scrollable-div">
                    <p id="logOutput"></p>
                  </div>
                </div>
                <script>
                  const originalConsoleLog = console.log;
                  const logOutput = document.getElementById('logOutput');

                  console.log = function (message) {
                    originalConsoleLog.apply(console, arguments);

                    if (Array.isArray(message)) {
                      const arrayContainer = document.createElement('div');
                      const indentSize = 40;

                      arrayContainer.style.paddingLeft = `${1 * indentSize}px`;
                      arrayContainer.style.paddingRight = `${1 * indentSize}px`;

                      const spacer = document.createElement('span');
                      spacer.textContent = "";
                      arrayContainer.appendChild(spacer);

                      arrayContainer.appendChild(document.createElement('br'));

                      message.forEach(function (element) {
                        const lines = element.split('\n');
                        lines.forEach(function (line) {
                          const logMessage = document.createElement('span');
                          logMessage.textContent = line;
                          arrayContainer.appendChild(logMessage);

                          const spacer2 = document.createElement('p');
                          spacer2.textContent = "";
                          arrayContainer.appendChild(spacer2);
                        });

                      });

                      logOutput.appendChild(arrayContainer);
                    } else {
                      const currentDate = new Date();
                      const options = { timeZone: 'America/Chicago', hour12: true };
                      const cstTime = currentDate.toLocaleTimeString('en-US', options);
                      const logMessage = document.createElement('span');
                      logMessage.textContent = "[" + cstTime + "] " + message;
                      logOutput.appendChild(logMessage);
                      logOutput.appendChild(document.createElement('br'));
                    }

                    logOutput.scrollTop = logOutput.scrollHeight;
                  };

                </script>
            </div>
          </div>
        </div>
      </div>
      <hr>
      <p>© Copyright 2023, Blake Darrow.</p>
  </div>
  </div>
  </section>
  </div>
  <script>
    jQuery(function () {
      SphinxRtdTheme.Navigation.enable(true);
    });
  </script>
</body>
</html>